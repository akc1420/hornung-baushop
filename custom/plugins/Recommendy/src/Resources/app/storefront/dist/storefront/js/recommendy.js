"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["recommendy"],{6457:(e,t,i)=>{var r,n,o,s=i(9068),a=i(6285),l=i(3206),c=i(207),d=i(8254),u=i(1966);class m extends a.Z{init(){const e=this;let t=document.querySelectorAll(e.options.listProductsChildCol);u.Z.iterate(t,(t=>{let i=t.closest(e.options.productCardCol+":not([data-productid])");i&&(i.dataset.productid=t.getAttribute("data-productid"))})),this._getForm(),this.httpClient=new d.Z;const i=l.Z.querySelector(document,this.options.parentFilterPanelSelector);this.listing=window.PluginManager.getPluginInstanceFromElement(i,"Listing"),this._registerEvents()}_getForm(){if(this.el&&"FORM"===this.el.nodeName?this._form=this.el:this._form=this.el.closest("form"),!this._form)throw new Error(`No form found for the plugin: ${this.constructor.name}`)}_registerEvents(){this.el.addEventListener("submit",this._formSubmit.bind(this))}_formSubmit(e){e.preventDefault();const t=this,i=this.el.closest(this.options.productCardCol),r=i.querySelector(".recommendy-btn-similar");if(r.classList.contains("disabled"))return;r.classList.add("disabled");const n=l.Z.getAttribute(this._form,"action"),o=c.Z.serialize(this._form),s=t._getFilters();"object"==typeof s&&Object.keys(s).forEach((function(e){o.append(e,s[e])})),window._addedProductsQuantity&&o.append("alreadyViewedIds",t._getAlreadyViewedIds.call(t)),this.httpClient.post(n,o,(function(e){if(e){let r=(new DOMParser).parseFromString(e,"text/html").querySelectorAll(t.options.newAddedProductsCol),n=t.getNextSiblings(i);u.Z.iterate(r,(e=>{const t=e.getAttribute("data-productid");u.Z.iterate(n,(e=>{e.getAttribute("data-productid")===t&&e.remove()}))})),i.insertAdjacentHTML("afterEnd",e),window.PluginManager.initializePlugins(),window.setTimeout(t._addAnimatedClass.bind(t),100),t._calculateClonedProductsCount()}else{r.classList.add("no-display");const e=i.querySelector(".recommendy-btn-unique");e&&e.classList.remove("no-display")}})),this.$emitter.publish("beforeFormSubmit",o)}_addAnimatedClass(){const e=document.querySelectorAll(this.options.newProductCardCol);u.Z.iterate(e,(e=>e.classList.add("recommendy-animated")))}_getFilters(){const e=this.listing._fetchValuesOfRegisteredFilters();return this.listing._mapFilters(e)}_calculateClonedProductsCount(){const e=document.querySelectorAll(this.options.newAddedProductsCol);window._addedProductsQuantity={},u.Z.iterate(e,(e=>{const t=e.getAttribute("data-productid");window._addedProductsQuantity[t]?window._addedProductsQuantity[t]+=1:window._addedProductsQuantity[t]=1}))}_getAlreadyViewedIds(){const e=[];return Object.keys(window._addedProductsQuantity).forEach((function(t){window._addedProductsQuantity[t]>=2&&e.push(t)})),e}getNextSiblings(e,t){let i=[],r=e.parentNode.firstChild;do{3!==r.nodeType&&r!==e&&r===e.nextElementSibling&&(t&&!t(e)||(i.push(r),e=r))}while(r=r.nextSibling);return i}}r=m,o={productCardCol:".cms-listing-col",newProductCardCol:".recommendy-listing-col:not(.recommendy-animated)",parentFilterPanelSelector:".cms-element-product-listing-wrapper",newAddedProductsCol:".recommendy-listing-col",listProductsChildCol:".recommendy-default-listing-col"},(n=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(n="options"))in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o;class p extends a.Z{init(){const e=this,t=e.el.classList,i=e._isListing(t);t.contains("is-ctl-product"),t.contains("is-ctl-checkout"),t.contains("is-ctl-search");this.httpClient=new d.Z;let r=localStorage.getItem("RecommendyTracking");if(r&&(localStorage.removeItem("RecommendyTracking"),r=JSON.parse(r),this.httpClient.post(r.url,JSON.stringify({productId:r.productId,actionId:r.actionId,price:r.price}),(function(e){}))),i)return e.cmsListingRow=e.el.querySelector(e.options.cmsListingRow),void e.registerListingEventListeners();e.registerDetailEventListeners()}registerListingEventListeners(){const e=this;e.cmsListingRow&&e.cmsListingRow.addEventListener("click",e.onClickCmsListingRow.bind(e))}registerDetailEventListeners(){let e=this,t=this.options.detailSliderSelectors.join(", ");document.querySelectorAll(t).forEach((t=>{t.addEventListener("click",(t=>{e.recommendyTracking.call(e,t.target)}))}))}onClickCmsListingRow(e){let t=this,i=e.target;(i.classList.contains(t.options.productImageLink)||i.classList.contains(t.options.productNameLink)||i.closest("."+t.options.productImageLink)||i.closest("."+t.options.productNameLink)||"A"===i.tagName||"BUTTON"===i.tagName)&&t.recommendyTracking.call(t,i)}recommendyTracking(e){let t=this,i=t.el.classList,r=t._isListing(i),n=e.classList.contains("btn-buy"),o=r?e.closest(t.options.productCardCol):n?e.closest(".recommendy-buy-box-container"):e.closest(t.options.productBox),s=o?o.querySelector('input[name="recommendyTracking"]'):null;if(!s)return;if(n){if(r&&!o.getAttribute("data-recommendyRecommendation"))return;let e=s.getAttribute("data-recommendy-track-ajaxUrl");if(e){let t=o.querySelector('input[name="recommendyTrackingPrice"]').getAttribute("value"),i=s.getAttribute("value");(new d.Z).post(e,JSON.stringify({productId:i,actionId:10,price:t}),(function(e){}))}return}let a=s.getAttribute("data-recommendy-track-ajaxUrl"),l=o.querySelector('input[name="recommendyTrackingPrice"]').getAttribute("value");if(a){let e=s.getAttribute("value");if(r&&o.getAttribute("data-recommendyRecommendation"))localStorage.setItem("RecommendyTracking",JSON.stringify({url:a,productId:e,actionId:1,price:l}));else{let t=o.querySelector('input[name="recommendyTrackingActionId"]');if(t){if(t=+t.getAttribute("value"),t<=1)return;localStorage.setItem("RecommendyTracking",JSON.stringify({url:a,productId:e,actionId:t,price:l}))}}}}_isListing(e){return e.contains("is-ctl-navigation")&&e.contains("is-act-index")||e.contains("is-ctl-search")&&e.contains("is-act-search")}}!function(e,t,i){(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(p,"options",{productCardCol:".cms-listing-col",cmsListingRow:".cms-listing-row",productImageLink:"product-image-link",productNameLink:"product-name",productBox:".recommendy-item",detailSliderSelectors:[".recommendy-item .product-name",".recommendy-item .product-image-link",".recommendy-item .btn-buy",".recommendy-item .recommendy-product-link"]});var g=i(5659),h=i(5944);class y extends a.Z{init(){this._httpClient=new d.Z,this._radioFields=l.Z.querySelectorAll(this.el,this.options.radioFieldSelector,!1),this._selectFields=l.Z.querySelectorAll(this.el,this.options.selectFieldSelector,!1),this._elementId=this.options.elementId,this._pageType=this.options.pageType,this._ensureFormElement(),this._preserveCurrentValues(),this._registerEvents()}_ensureFormElement(){if("form"!==this.el.nodeName.toLowerCase())throw new Error("This plugin can only be applied on a form element!")}_preserveCurrentValues(){this._radioFields&&u.Z.iterate(this._radioFields,(e=>{y._isFieldSerializable(e)&&e.dataset&&(e.dataset.variantSwitchValue=e.value)}))}_registerEvents(){this.el.addEventListener("change",(e=>this._onChange(e)))}_onChange(e){const t=this._getSwitchedOptionId(e.target),i=this._getFormValue();this._preserveCurrentValues();const r={switched:t,options:JSON.stringify(i)};this._redirectToVariant(r)}_getSwitchedOptionId(e){return!!y._isFieldSerializable(e)&&e.name.split("_").pop()}_getFormValue(){const e={};return this._radioFields&&u.Z.iterate(this._radioFields,(t=>{y._isFieldSerializable(t)&&t.checked&&(e[t.name.split("_").pop()]=t.value)})),this._selectFields&&u.Z.iterate(this._selectFields,(t=>{if(y._isFieldSerializable(t)){const i=[...t.options].find((e=>e.selected));e[t.name.split("_").pop()]=i.value}})),e}static _isFieldSerializable(e){return!e.name||e.disabled||-1===["file","reset","submit","button"].indexOf(e.type)}_disableFields(){u.Z.iterate(this._radioFields,(e=>{e.classList&&e.classList.add("disabled","disabled")}))}_redirectToVariant(e){g.Z.create();const t=l.Z.getAttribute(this.el,"action")+"?"+h.stringify(e);this._httpClient.get(t,(e=>{let t=(new DOMParser).parseFromString(e,"text/html");const i=this.el.closest(".recommendy-item"),r=l.Z.querySelector(t,".recommendy-item",!0);let n=l.Z.querySelectorAll(t,".recommendy-collapse",!1);n&&u.Z.iterate(n,(e=>{e.classList.add("show")})),i.innerHTML=r.innerHTML,window.PluginManager.initializePlugins(),g.Z.remove()}))}}!function(e,t,i){(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(y,"options",{url:"",elementId:"",pageType:"",radioFieldSelector:".product-detail-configurator-option-input",selectFieldSelector:".product-detail-configurator-select-input"}),s.Z.register("GetRecommendyProducts",m,"[data-get-recommendy-products]"),s.Z.register("RecommendyTracking",p,"body"),s.Z.register("RecommendyTracking",p,".offcanvas-cart"),s.Z.register("RecommendyVariantSwitchPlugin",y,"[data-recommendy-ajax-variants-container]")}},e=>{e.O(0,["vendor-node","vendor-shared"],(()=>{return t=6457,e(e.s=t);var t}));e.O()}]);